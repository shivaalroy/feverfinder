<!DOCTYPE html>

<html>
<body>
   <head>
   <title> FeverFinder </title>
    <link href = 'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css' rel = 'stylesheet'>
    <meta name="description" content="FeverFinder Temperature Graph.">

    <script src="pico/client.js"></script>
    <script type="text/javascript" src="canvasjs/canvasjs.min.js"></script>

    <script>
        pico.load("get");
    </script>

    <script type="text/javascript">
    var dps = []; // dataPoints

    var chart = new CanvasJS.Chart("chartContainer",{
        title :{
            text: "Live Temperature Data"
        },          
        data: [{
            type: "line",
            dataPoints: dps 
        }]
    });

    setInterval(function() {
        get.getData(function(response) {
            
            window.onload = function() {

                console.log(response); 
                var xVal = 0;
                var yVal = 50; 
                //var updateInterval = 100;
                var dataLength = 20; // number of dataPoints visible at any point

                var updateChart = function (count) {

                        yVal = yVal +  Math.round(5 + Math.random() *(-5-5)); //replace with code to pull from Postgre database
                        dps.push({
                            x: xVal,
                            y: yVal
                        });
                        xVal++;
                    };
                    if (dps.length > dataLength)
                    {
                        dps.shift();                
                    }
                    
                    chart.render();    
                    count++; 

                };

                // generates first set of dataPoints
                updateChart(dataLength); 

                // update chart after specified time. 
                //setInterval(function(){updateChart()}, updateInterval);    
            });

        }, 1000);
    </script>
</head>
<body>
    <div id="chartContainer" style="height: 300px; width:100%;">
    </div>
</body>
</html>